{% extends 'base.html' %}



{% block titulo %}  index  {% endblock titulo%}


{% block conteudo %}
<div id="section" class="conteiner">
	{% if user %}
		{% if user.solsLen > 0 %}
		<div class="publicacoes">
			<b>Solicitações</b><br>
			<ul>
				
					{% for sol in user.sols %}
						<li>{{sol.user.nome}}
							<a class="btn btn-outline-primary" href="/amizade/responder/{{sol.user.id}}/">Aceitar</a> 
							<a class="btn btn-outline-danger" href="/amizade/cancelar_solicitacao/{{sol.user.id}}/">Recusar</a>
						</li>
					{% endfor %}
			</ul>
		</div>
	{% endif %}
{% endif %}
		<br><br>
		{% for post in posts %}
		<div class="publicacoes">
			{%if user %}
				{% if user.id == post.user.id %}
					<span class="" onclick="$('.editar-{{post.id}}').toggle()">. . .</span><br>
					<div  style="display:none;" class="editar-{{post.id}}">
						<a class="btn btn-outline-warning" href="/editar/post/{{post.id}}/">Editar</a>
						<a class="btn btn-outline-danger" href="/excluir/post/{{post.id}}/">excluir</a>
					</div>
				{% endif %}
				{% if post.id_user != user.id %}
					{% if post.amigo %}
						<sub>AMIGO✓</sub>
						<a class="btn btn-outline-danger" href="/amizade/desfazer/{{post.user.id}}/">Desfazer Amizade</a>
					
					{% elif user.sols %}
						{% for sol in user.sols %}
							{% if sol.user.id == post.id_user %}
								<a class="btn btn-outline-success" href="/amizade/responder/{{post.user.id}}/">Aceitar Solicitação</a>
							{% endif %}
						{% endfor %}
					{% elif post.jasol %}
						<a class="btn btn-outline-warning" href="/amizade/cancelar_solicitacao/{{post.user.id}}/">Cancelar Solicitação</a>
					{% else %}
						<a class="btn btn-primary" href="/amizade/solicitar/{{post.user.id}}/">Mandar Solicitação</a>
						<br>
						<br>
					{% endif %}
				{% endif %}
			{% endif %}
			<h3>
				<a href="/perfil/{{post.user.id}}">
				{% if post.user.img %}
					<img class="miniatura" src="data:;base64,{{post.user.img}}">
				{% endif %}
				{{post.user.nome.split()[0]}}
				</a>
			</h3>
			<sup>
				{{post.data_cr.day }}/{{post.data_cr.month }}/{{post.data_cr.year }} às {{post.data_cr.hour }}:{{post.data_cr.minute }}
			</sup>
			<br>
			<pre><i>{{post.body_post}}</i></pre>
			<div class="carousel slide" data-ride="carousel">
	 			<div class="carousel-inner">
	
					{% for img in post.imgs[post.id]%}
						{% if img %}
							<hr>
							{% if img == post.imgs[post.id][0]%}
			 					<div class="carousel-item active">
									<img class="d-block w-100" src="data:;base64,{{img}}">
								</div>
							{% else %}
			 					<div class="carousel-item">
									<img class="d-block w-100"  src="data:;base64,{{img}}">
								</div>
							{% endif %}
						{% endif %}
					{% endfor %}
						<hr>
				</div>
			</div>
			{%if user %}
			<div>
				{% if post.Liked %}
					<a class="btn btn-primary" href="/post/unlike/{{post.id}}/">
						{% if post.reactLen < 2 %}
							{{post.reactLen}} like
						{% else %}
							{{post.reactLen}} likes 
						{% endif %}
					</a>
				{% else %}
					<a class="btn btn-outline-primary" href="/post/like/{{post.id}}/">
						{% if post.reactLen < 2 %}
							{{post.reactLen}} like
						{% else %}
							{{post.reactLen}} likes 
						{% endif %}
					</a>
				{% endif %}
				<span  onclick="$('#comentario-{{post.id}}').toggle()">{% if post.commLen == 0 %} Nenhum {% else %}{{post.commLen}}{% endif%}{% if post.commLen  < 2 %} Comentário {% else %} Comentários {% endif %}</span>
			</div>
			{% endif %}
			{% if post.comm %}
				<div id="comentario-{{post.id}}" class="publicacoes" style="display:none;">
			
			
					{% for comm in post.comm %}
						<div class="">
							<b>{%if comm.user.img %}<img class="miniatura" src="data:;base64,{{ comm.user.img }}">{%endif%}
								{{ comm.user.nome}}
							{% if comm.user.id == post.id_user %}
								<sup>autor</sup>
							{% endif %}
							{% if user %}
							
								{% if user.id == comm.user.id %}
									<span onclick="$('.editar-{{comm.id}}').toggle()">...</span><br>
									<div  style="display:none;" class="editar-{{comm.id}}">
										<a class="btn btn-outline-warning" href="/editar/comm/{{comm.id}}/">Editar</a>
										<a class="btn btn-outline-danger" href="/excluir/comm/{{comm.id}}/">excluir</a>
									</div>
								{% endif %}
							{% endif %}
							</b>
							<pre><i>{{comm.body}}</i></pre>
						</div>
						<hr>
					{% endfor %}
				</div>
			{% endif%}
			<br>
			{% if user %}
				<form action="/post/comentario/{{post.id}}/" method="post">
					<textarea  type="text" name="body" class="form-control" placeholder="comentario"></textarea><br>
					<button type="submit" class="form-control btn btn-primary">Comentar</button>
				</form>
			{% endif %}
		</div>
		<hr>
		{% endfor %}
	
</div>
{% endblock conteudo %}